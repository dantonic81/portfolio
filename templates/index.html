<!-- templates/index.html -->
{% extends 'base.html' %}

{% block title %}Crypto Portfolio - Home{% endblock %}

{% block content %}

{% block modals %}
    {{ super() }}
    {% include 'modals/add_asset_modal.html' %}
{% endblock %}

<!-- Jumbotron Section -->
<div class="jumbotron text-center mb-4">
  <div class="container">
    <h1 class="display-4">Track Your Crypto Success in Real-Time</h1>
    <p>Get insights on your owned assets, explore top cryptocurrencies, and find outliers in the market.</p>
    <hr class="my-4">


    <!-- Portfolio Value Display -->
    <section class="portfolio-value-section mb-4">
      <h2 class="header-title">Portfolio Value</h2>
      <div class="portfolio-value">
        <span id="portfolio-value" class="value">${{ total_portfolio_value }}</span>
        <span id="percentage-change" class="change {{ 'positive' if percentage_change > 0 else 'negative' }}">
          {{ formatted_percentage_change }}
        </span>
      </div>
    </section>

    <!-- Total Investment Section -->
    <section class="total-investment-section mb-4">
      <h3>Your Total Investment</h3>
      <p class="investment-amount">{{ total_investment }} EUR</p>
    </section>

    <!-- Return on Investment Section -->
    <section class="roi-section">
      <h3>Your Return on Investment</h3>
      <p class="roi-value {{ 'positive' if nominal_roi > 0 else 'negative' }}">Nominal ROI: {{ formatted_nominal_roi }}</p>
    </section>

    <section class="gainers-losers-section mb-4">
      <div class="container">
        <div class="row">
          <!-- Gainers -->
          <div class="col-md-6">
            <h3 class="text-success">Top Gainers</h3>
            <ul class="list-group">
              {% for coin in gainers[:3] %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div class="coin-info d-flex w-100">
                    <!-- Coin Name and Symbol -->
                    <div class="text-info">
                      <span class="coin-name">{{ coin['name'] }}</span>
                      <span class="secondary-text">({{ coin['symbol'] | upper }})</span>
                    </div>
                    <!-- Price Change Badge -->
                    <span class="badge badge-success badge-pill">
                      <i class="fas fa-arrow-up"></i> {{ coin['price_change_percentage_24h'] | round(2) }}%
                    </span>
                  </div>
                </li>

              {% endfor %}
            </ul>
          </div>
          <!-- Losers -->
          <div class="col-md-6">
            <h3 class="text-danger">Top Losers</h3>
            <ul class="list-group">
              {% for coin in losers[:3] %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div class="coin-info">
                  <!-- Coin Name and Symbol -->
                  <div class="text-info">
                    <span class="coin-name">{{ coin['name'] }}</span>
                    <span class="secondary-text">({{ coin['symbol'] | upper }})</span>
                  </div>
                  <span class="badge badge-danger badge-pill">
                  <i class="fas fa-arrow-down"></i>{{ coin['price_change_percentage_24h'] | round(2) }}%</span>
                </div>
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </section>


    <!-- Quick Action Buttons - Repositioned for Visibility -->
    <section class="cta-buttons d-flex justify-content-center flex-wrap">
      <div class="d-flex justify-content-center">
          <button type="button" class="btn btn-primary w-100" data-toggle="modal" data-target="#addAssetModal" title="Add a new asset">
            <i class="fas fa-plus-square"></i> Add Asset
          </button>
          <button type="button" class="btn btn-primary w-100" data-toggle="modal" data-target="#editAssetModal" title="Edit an existing asset">
            <i class="fas fa-edit"></i> Edit Asset
          </button>
          <button type="button" class="btn btn-primary w-100" data-toggle="modal" data-target="#setAlertsModal" title="Set price alerts">
            <i class="fas fa-bell"></i> Set Alerts
          </button>
          <button type="button" class="btn btn-primary w-100" data-toggle="modal" data-target="#openEditAlertsModal" title="Edit Active Alerts">
            <i class="fas fa-trash-alt"></i> Delete Alerts
          </button>
      </div>
    </section>
  </div>
</div>


<div class="modal fade" id="setAlertsModal" tabindex="-1" role="dialog" aria-labelledby="setAlertsModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="setAlertsModalLabel">Set Price Alerts</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="alertForm">
          <!-- Dynamic coin list will be populated here -->
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <div class="sticky-save-button">
          <button type="button" class="btn btn-primary" id="saveAlertsButton">Save Alerts</button>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Edit Asset Modal -->
<div class="modal fade" id="editAssetModal" tabindex="-1" role="dialog" aria-labelledby="editAssetModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editAssetModalLabel">Edit Asset</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Search bar to search for assets -->
        <input type="text" id="searchAsset" class="form-control mb-3" placeholder="Search for an asset...">
        <!-- List of search results -->
        <ul id="assetResults" class="list-group mt-2" style="max-height: 200px; overflow-y: auto;">
          <!-- Search results will be dynamically populated here -->
        </ul>

        <!-- Asset details to edit (hidden until asset is selected) -->
        <input type="hidden" id="edit-asset-id">
        <div class="form-group">
          <label for="edit-asset-name">Asset Name</label>
          <input type="text" class="form-control" id="edit-asset-name" disabled>
        </div>
        <div class="form-group">
          <label for="edit-asset-amount">Enter New Amount</label>
          <input type="number" class="form-control" id="edit-asset-amount">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" id="deleteAssetButton" title="Delete this asset">Delete Asset</button>
        <button type="button" class="btn btn-primary" id="saveChangesButton" title="Save changes to the asset">Save Changes</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal for Managing Alerts -->
<div class="modal fade" id="openEditAlertsModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Manage Active Alerts</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="alertListContainer"></div> <!-- List of active alerts will be shown here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/alerts.js') }}" defer></script>
{% endblock %}
